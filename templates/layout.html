<!DOCTYPE html>
<html>
  <head>
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <nav class="nav-row">
      <div class="nav-inner">
        <a class="logo" href="/"
          ><h1>CAR<span class="brand-blue">VAULT</span></h1></a
        >
        <div class="controls">
          <a href="/comparisons" class="btn btn-primary">Show comparisons</a>
        </div>
      </div>
    </nav>
    {{embed}}
    <script>
      document.addEventListener("click", function (e) {
        // only handle clicks on favorite buttons
        const btn = e.target.closest && e.target.closest(".favorite-btn");
        if (!btn) return;

        // prevent the form submit / navigation
        e.preventDefault();

        const id = btn.getAttribute("data-id");
        if (!id) return;

        // optimistic UI: toggle heart immediately so UI feels snappy
        const current = btn.textContent.trim();
        const wasAdded = current === "‚ù§Ô∏è";
        btn.textContent = wasAdded ? "ü§ç" : "‚ù§Ô∏è";

        // Send the POST using form-encoded body
        const body = new URLSearchParams();
        body.append("id", id);

        fetch("/favorite/toggle", {
          method: "POST",
          headers: {
            "X-Requested-With": "XMLHttpRequest",
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: body.toString(),
        })
          .then((response) => {
            if (!response.ok) throw new Error("Network response not ok");
            return response.json();
          })
          .then((data) => {
            // server returns { added: true/false, id: <id> }
            if (!("added" in data)) {
              // unexpected response ‚Äî revert UI
              btn.textContent = wasAdded ? "‚ù§Ô∏è" : "ü§ç";
              return;
            }
            // reflect server truth
            btn.textContent = data.added ? "‚ù§Ô∏è" : "ü§ç";
          })
          .catch((err) => {
            // revert on error and optionally log
            console.error("favorite toggle failed", err);
            btn.textContent = wasAdded ? "‚ù§Ô∏è" : "ü§ç";
          });
      });
    </script>
  </body>
</html>
